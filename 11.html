<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>TA-TMA风险预测计算器</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;max-width:600px;margin:0 auto;padding:20px;background:#f5f5f5}
.calculator{background:#fff;padding:30px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.1)}
h1{color:#2c3e50;text-align:center;margin-bottom:30px}
.form-group{margin-bottom:20px}
label{display:block;margin-bottom:5px;font-weight:bold;color:#34495e}
select{width:100%;padding:10px;border:2px solid #ddd;border-radius:5px;font-size:16px}
button{width:100%;padding:15px;background:#3498db;color:#fff;border:none;border-radius:5px;font-size:18px;cursor:pointer;margin-top:20px}
button:hover{background:#2980b9}
.result{margin-top:30px;padding:20px;border-radius:5px;text-align:center}
.low-risk{background:#d4edda;color:#155724;border:2px solid #c3e6cb}
.medium-risk{background:#fff3cd;color:#856404;border:2px solid #ffeeba}
.high-risk{background:#f8d7da;color:#721c24;border:2px solid #f5c6cb}
.probability{font-size:24px;font-weight:bold}
.interpretation{margin-top:10px;font-style:italic;font-size:16px}
.risk-explanation{margin-top:10px;font-size:14px}
</style>
</head>

<body>
<div class="calculator">
<h1>TA-TMA风险预测计算器</h1>

<div class="form-group"><label>III/IV级 GVHD:</label><select id="gvhd"><option value="0">无</option><option value="1">有</option></select></div>
<div class="form-group"><label>诊断:</label><select id="diagnosis"><option value="0">其他诊断</option><option value="1">OS/HLH/CAEBV</option></select></div>
<div class="form-group"><label>HLA匹配:</label><select id="hla"><option value="0">全相合</option><option value="1">半相合</option></select></div>
<div class="form-group"><label>血红蛋白:</label><select id="hb"><option value="0">≥80 g/L</option><option value="1"><80 g/L</option></select></div>
<div class="form-group"><label>D-二聚体:</label><select id="ddimer"><option value="0"><0.243 mg/L</option><option value="1">≥0.243 mg/L</option></select></div>
<div class="form-group"><label>CMV感染:</label><select id="cmv"><option value="0">阴性</option><option value="1">阳性</option></select></div>
<div class="form-group"><label>LDH:</label>
  <select id="ldh">
    <option value="0">正常范围</option>
    <option value="1">＞正常范围上限</option>
  </select>
</div>
<div class="form-group"><label>细菌感染:</label><select id="bacteria"><option value="0">无</option><option value="1">有</option></select></div>

<!-- 统一加上“移植物”三个字 -->
<div class="form-group"><label>移植物CD4/CD8比值:</label>
  <select id="cd4cd8">
    <option value="0">≤1.43</option>
    <option value="1">>1.43</option>
  </select>
</div>

<button onclick="calcRisk()">计算风险概率</button>

<div class="result" id="res" style="display:none">
  <div class="probability" id="prob"></div>
  <div class="interpretation" id="inter"></div>
  <div class="risk-explanation" id="advice"></div>
</div>
</div>

<script>
function calcRisk(){
  const coef={
    gvhd:2.3455, diagnosis:0.8110, hla:1.1225, hb:0.9219, ddimer:1.0103,
    cmv:0.7049, ldh:0.9600, bacteria:0.5823, cd4cd8:0.6033
  };
  let x=-3.6829;
  Object.keys(coef).forEach(k=> x+= coef[k]*parseInt(document.getElementById(k).value));
  const p=1/(1+Math.exp(-x));
  const pct=(p*100).toFixed(1);
  let cls, risk, adv;
  if(p>0.75){      cls='high-risk'; risk='高危'; adv='建议密切监测，积极干预治疗';}
  else if(p>0.50){ cls='medium-risk'; risk='中危'; adv='建议定期监测，注意相关症状';}
  else{            cls='low-risk'; risk='低危'; adv='常规监测，低概率发生TA-TMA';}
  const res=document.getElementById('res');
  res.className='result '+cls;
  document.getElementById('prob').textContent='移植后100天内发生TA-TMA的风险概率：'+pct+'%';
  document.getElementById('inter').textContent='风险等级：'+risk;
  document.getElementById('advice').textContent=adv;
  res.style.display='block';
}
</script>
</body>
</html>